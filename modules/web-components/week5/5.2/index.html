<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>5.2 MAD9022 | MAD9022</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Fullstack: Frontend Development Course">
    
    <link rel="preload" href="/w2023/assets/css/0.styles.33e990fb.css" as="style"><link rel="preload" href="/w2023/assets/js/app.49733bfc.js" as="script"><link rel="preload" href="/w2023/assets/js/2.e00fc094.js" as="script"><link rel="preload" href="/w2023/assets/js/3.1ae5a99d.js" as="script"><link rel="preload" href="/w2023/assets/js/9.b21c66c5.js" as="script"><link rel="preload" href="/w2023/assets/js/11.92cefe25.js" as="script"><link rel="prefetch" href="/w2023/assets/js/10.41910312.js"><link rel="prefetch" href="/w2023/assets/js/12.b4bafa0d.js"><link rel="prefetch" href="/w2023/assets/js/13.ba803485.js"><link rel="prefetch" href="/w2023/assets/js/14.1e383464.js"><link rel="prefetch" href="/w2023/assets/js/15.bacbf527.js"><link rel="prefetch" href="/w2023/assets/js/16.e7714ee9.js"><link rel="prefetch" href="/w2023/assets/js/17.3aada0e0.js"><link rel="prefetch" href="/w2023/assets/js/18.96ead32f.js"><link rel="prefetch" href="/w2023/assets/js/19.4e5249bf.js"><link rel="prefetch" href="/w2023/assets/js/20.5dee1097.js"><link rel="prefetch" href="/w2023/assets/js/21.ec6718fa.js"><link rel="prefetch" href="/w2023/assets/js/22.fa6508dc.js"><link rel="prefetch" href="/w2023/assets/js/23.9a4c47c6.js"><link rel="prefetch" href="/w2023/assets/js/24.b2a84dff.js"><link rel="prefetch" href="/w2023/assets/js/25.85a09377.js"><link rel="prefetch" href="/w2023/assets/js/26.f1eb484c.js"><link rel="prefetch" href="/w2023/assets/js/27.25c44fa0.js"><link rel="prefetch" href="/w2023/assets/js/28.51999317.js"><link rel="prefetch" href="/w2023/assets/js/29.65075bca.js"><link rel="prefetch" href="/w2023/assets/js/30.5d45979f.js"><link rel="prefetch" href="/w2023/assets/js/31.22b62fdb.js"><link rel="prefetch" href="/w2023/assets/js/32.bd051bb4.js"><link rel="prefetch" href="/w2023/assets/js/33.56eaee4e.js"><link rel="prefetch" href="/w2023/assets/js/34.62593793.js"><link rel="prefetch" href="/w2023/assets/js/35.4456d2ac.js"><link rel="prefetch" href="/w2023/assets/js/36.2f2d8a40.js"><link rel="prefetch" href="/w2023/assets/js/37.5e082827.js"><link rel="prefetch" href="/w2023/assets/js/38.71855794.js"><link rel="prefetch" href="/w2023/assets/js/39.485f42ce.js"><link rel="prefetch" href="/w2023/assets/js/4.64bbff17.js"><link rel="prefetch" href="/w2023/assets/js/40.8e5ddf6e.js"><link rel="prefetch" href="/w2023/assets/js/41.fea3541d.js"><link rel="prefetch" href="/w2023/assets/js/42.d3040fe8.js"><link rel="prefetch" href="/w2023/assets/js/43.0e1d1cc9.js"><link rel="prefetch" href="/w2023/assets/js/44.fbbee689.js"><link rel="prefetch" href="/w2023/assets/js/45.90d16594.js"><link rel="prefetch" href="/w2023/assets/js/46.fa7c6a52.js"><link rel="prefetch" href="/w2023/assets/js/47.3fb6e90a.js"><link rel="prefetch" href="/w2023/assets/js/48.2c7860fe.js"><link rel="prefetch" href="/w2023/assets/js/5.8ce5e2d0.js"><link rel="prefetch" href="/w2023/assets/js/6.a0bc34a0.js"><link rel="prefetch" href="/w2023/assets/js/7.0dc96026.js"><link rel="prefetch" href="/w2023/assets/js/8.c36795df.js">
    <link rel="stylesheet" href="/w2023/assets/css/0.styles.33e990fb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/w2023/" class="home-link router-link-active"><!----> <span class="site-name">MAD9022</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/w2023/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2023/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2023/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/w2023/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2023/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2023/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hybrid</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Web Components &amp; PWAs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/w2023/modules/web-components/week1/1.1/" class="sidebar-link">1.1: Web Components</a></li><li><a href="/w2023/modules/web-components/week2/2.1/" class="sidebar-link">2.1: Component Methods</a></li><li><a href="/w2023/modules/web-components/week2/2.2/" class="sidebar-link">2.2: Styling Components</a></li><li><a href="/w2023/modules/web-components/week3/3.1/" class="sidebar-link">3.1: Web Storage, Cookies, &amp; Cache</a></li><li><a href="/w2023/modules/web-components/week3/3.2/" class="sidebar-link">3.2: Cache, Files &amp; Responses</a></li><li><a href="/w2023/modules/web-components/week4/4.1/" class="sidebar-link">4.1: Intro to Workers</a></li><li><a href="/w2023/modules/web-components/week4/4.2/" class="sidebar-link">4.2: Service Workers</a></li><li><a href="/w2023/modules/web-components/week5/5.1/" class="sidebar-link">5.1: Intro to PWA</a></li><li><a href="/w2023/modules/web-components/week5/5.2/" aria-current="page" class="active sidebar-link">5.2: PWA Audits, Offline, &amp; Async Methods</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week5/5.2/#lighthouse-audits-for-pwa" class="sidebar-link">Lighthouse Audits for PWA</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week5/5.2/#waituntil-skipwaiting-claim" class="sidebar-link">WaitUntil, SkipWaiting, Claim</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week5/5.2/#offline-first" class="sidebar-link">Offline First</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week5/5.2/#more-accuracy-through-testing" class="sidebar-link">More Accuracy Through Testing.</a></li></ul></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week5/5.2/#launching-native-app-alternative" class="sidebar-link">Launching Native App Alternative</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week5/5.2/#determine-if-website-or-pwa" class="sidebar-link">Determine if Website or PWA</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week5/5.2/#enhanced-install-experiences" class="sidebar-link">Enhanced Install Experiences</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week5/5.2/#how-you-can-ask-users-to-install" class="sidebar-link">How you can Ask Users to Install</a></li></ul></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week5/5.2/#todo-this-week" class="sidebar-link">ToDo This Week</a></li></ul></li><li><a href="/w2023/modules/web-components/week6/6.1/" class="sidebar-link">6.1: Messaging &amp; Screen APIs</a></li><li><a href="/w2023/modules/web-components/week6/6.2/" class="sidebar-link">6.2: PWA Project and Review</a></li><li><a href="/w2023/modules/web-components/week7/7.1/" class="sidebar-link">7.1: PWA Project</a></li></ul></section></li><li><a href="/w2023/modules/reading/" class="sidebar-link">Reading Week</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deliverables</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title blue">
    PWA
  </div> <h1>5.2 MAD9022</h1></header> <h2 id="lighthouse-audits-for-pwa"><a href="#lighthouse-audits-for-pwa" class="header-anchor">#</a> Lighthouse Audits for PWA</h2> <p>Lighthouse is an Audit tool built into the Chrome Web Dev tools which let's you know if your website meets all the requirements for being a Progressive Web App.</p> <p>Open the Chrome Dev tools and look for the <code>Lighthouse</code> tab (previously 'Audit'). It can run a number of tests. However, the category we want is the <code>Progressive Web App</code> one. Only select that
checkbox and then click the <strong>Generate Report</strong> button.</p> <p>It will take a minute or two to run the audit.</p> <p>The results are split into three groups.</p> <ol><li>Fast and Reliable</li> <li>Installable</li> <li>PWA Optimized</li></ol> <p>We want green checkmarks || circles for everything!</p> <p>Just like Service Workers, PWAs need <code>https</code> to work but they are allowed to run on <code>localhost</code> or <code>127.0.0.1</code> without it.</p> <h2 id="waituntil-skipwaiting-claim"><a href="#waituntil-skipwaiting-claim" class="header-anchor">#</a> WaitUntil, SkipWaiting, Claim</h2> <p>The <code>install</code>, <code>activate</code>, <code>fetch</code>, and <code>message</code> events are all <code>ExtendableEvents</code>. That means we can use the <code>ev.waitUntil()</code> method to delay the completion of our event listener function until
after a Promise has resolved.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>ev<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//function that runs and does something that could take some time</span>
    <span class="token comment">//when we are done we call:</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//which will pass our result back to the waitUntil method</span>
    <span class="token comment">// as a resolved Promise object.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div title="WaitUntil, SkipWaiting, Claim" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/nhkpOK3NfW0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <p>The <code>self.skipWaiting()</code> method tells the service worker that it does not need to wait to be activated. It should skip the <code>waiting</code> phase and immediately start activating. This will trigger the
<code>activate</code> event listener function.</p> <p>It is important to remember that the web page still will not be communicating with the new service worker. It still thinks that the old service worker is running.</p> <p>This brings us to the <code>clients.claim()</code> method, which, if run inside the <code>activate</code> event listener function, will find all the windows and tabs that are currently running and tell them that the new
service worker is activated and should be referenced now.</p> <h2 id="offline-first"><a href="#offline-first" class="header-anchor">#</a> Offline First</h2> <p>The window object has an <code>online</code> and <code>offline</code> event that we can listen for.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//listen for on and off line events</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//tell the service worker about the change to online</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//tell the service worker about the change to offline</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>The <code>online</code> and <code>offline</code> event is fairly dependable for telling us that a connection to the wi-fi network has been established or lost. However, it does NOT tell us about failures for the wi-fi
network to actually get online. It also does NOT tell us if our connection is really poor. A one-bar connection to a network is still considered &quot;online&quot;.</p> <p>The default value for this can be found in the <code>navigator</code> object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> isOnline <span class="token operator">=</span> <span class="token string">'onLine'</span> <span class="token keyword">in</span> navigator <span class="token operator">&amp;&amp;</span> navigator<span class="token punctuation">.</span>onLine<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The example above, checks for existence of the <code>onLine</code> property and then find it's Boolean value.</p> <div title="online, offline, or wtf" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/45so6LA8wRY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h3 id="more-accuracy-through-testing"><a href="#more-accuracy-through-testing" class="header-anchor">#</a> More Accuracy Through Testing.</h3> <p>We can make a fetch call from either the webpage or our Service Worker that uses the <code>HEAD</code> method instead of <code>GET</code> or <code>POST</code>, just to see if we get a response.</p> <p>Use an endpoint that is guaranteed to be available, or use a test of your own API. Have a health check route that returns minimal data or accepts the <code>HEAD</code> method. If you get a <strong>VALID</strong> response
from the server then that can be used as proof of being online.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">isConnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'/api/alive'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'HEAD'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>You will have to edit the above code sample to use a proper URL to test.</p> <h2 id="launching-native-app-alternative"><a href="#launching-native-app-alternative" class="header-anchor">#</a> Launching Native App Alternative</h2> <p>If you have a true Native application and you want to have the user be prompted to install a platform specific native version as an alternative to your PWA then you can update the web manifest file to
have the mobile device prompt the user with their choices.</p> <p>We have to add the following two settings in the web manifest file.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;prefer_related_applications&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;related_applications&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;platform&quot;</span><span class="token operator">:</span> <span class="token string">&quot;play&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://play.google.com/store/apps/details?id=com.example.app1&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;com.example.app1&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;platform&quot;</span><span class="token operator">:</span> <span class="token string">&quot;itunes&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://itunes.apple.com/app/example-app1/id123456789&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>If there is no native alternative then omit the <code>prefer_related_applications</code> setting or have it set to <code>false</code>.</p> <h2 id="determine-if-website-or-pwa"><a href="#determine-if-website-or-pwa" class="header-anchor">#</a> Determine if Website or PWA</h2> <p>We can actually determine whether our web app is running as a basic website that has a service worker or if it was launched as a PWA.</p> <p>Use the following script to determine the load context and add any custom code based on those circumstances.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//check if the app was launched from installed version</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>standalone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Launched: Installed (iOS)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">APP</span><span class="token punctuation">.</span>isStandalone <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">matchMedia</span><span class="token punctuation">(</span><span class="token string">'(display-mode: standalone)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>matches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Launched: Installed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">APP</span><span class="token punctuation">.</span>isStandalone <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log('Launched: Browser Tab');</span>
  <span class="token constant">APP</span><span class="token punctuation">.</span>isStandalone <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div title="PWA determine launch source" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/Fcc18-zLwTM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <p>There is also a way that we can listen for changes to the <code>display-mode</code>. We can add an event listener to the <code>window.matchMedia</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">matchMedia</span><span class="token punctuation">(</span><span class="token string">'(display-mode: standalone)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> displayMode <span class="token operator">=</span> <span class="token string">'browser'</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>evt<span class="token punctuation">.</span>matches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    displayMode <span class="token operator">=</span> <span class="token string">'standalone'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Log display mode change to analytics</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DISPLAY_MODE_CHANGED'</span><span class="token punctuation">,</span> displayMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="enhanced-install-experiences"><a href="#enhanced-install-experiences" class="header-anchor">#</a> Enhanced Install Experiences</h2> <p>With a Chrome based browser we have access to that <a href="/w2023/modules/web-components/week5/week10/#handling-install-events-in-chrome">deferred install prompt event discussed last week</a>.</p> <p>When we feel that it is a good time to ask the user to install we used this code to prompt them:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">APP</span><span class="token punctuation">.</span>deferredPrompt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token constant">APP</span><span class="token punctuation">.</span>deferredPrompt<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">APP</span><span class="token punctuation">.</span>deferredPrompt<span class="token punctuation">.</span>userChoice<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">choiceResult</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>choiceResult<span class="token punctuation">.</span>outcome <span class="token operator">===</span> <span class="token string">'accepted'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'User accepted the install prompt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'User dismissed the install prompt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>This will display the built-in install prompt.</p> <p>However, other browsers have different mechanisms for allowing the user to add an app to the home screen called <code>A2HS</code> (install it).</p> <p>We can add our own UI elements for the user to click to initiate the install. Fine for Chrome but on the other browsers we need to display instructions on how to <code>Add to Home Screen</code>.</p> <p>On a desktop browser you can expect to see a small icon in the location bar. Here is an example of the Safari A2HS button on Safari desktop.</p> <p><img src="/w2023/assets/img/safari-install.21040dbe.png" alt="a2sh safari"></p> <p>Note the small square with the upwards pointing arrow, on the right side of the image.</p> <h4 id="on-ios-safari"><a href="#on-ios-safari" class="header-anchor">#</a> On iOS Safari</h4> <p>On Safari on iOS you will see a button in the menu that is similar to the Safari desktop one. <img width="30" height="30" src="/w2023/assets/img/square-upload-ios.9541d65a.svg" alt="safari share icon"> Clicking this will
give the user Sharing options dialog which includes <code>Add to Home Screen</code>.</p> <p><img src="/w2023/assets/img/safari-ios-a2hs-icon.bf76cf64.png" alt="ios install button"></p> <h4 id="on-firefox-mobile"><a href="#on-firefox-mobile" class="header-anchor">#</a> On Firefox Mobile</h4> <p>On Firefox the user can open the browser menu like the one below, and find an item called either <code>install</code> or <code>add to homescreen</code>.</p> <p><img src="/w2023/assets/img/firefox-install.3020a216.png" alt="firefox a2hs"></p> <p>Or in the location bar when on Firefox desktop:</p> <p><img src="data:image/png;base64,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" alt="firefox a2hs"></p> <p>For Firefox there may also be an Add to Home Icon in the mobile version. It looks like a small house with a plus sign. It will depend on which version of Firefox that your users are using.</p> <h4 id="on-chrome-mobile"><a href="#on-chrome-mobile" class="header-anchor">#</a> On Chrome Mobile</h4> <p>Similar to the the Firefox mobile menu you will find a button and label in the menu called <code>Add to Home screen</code>.</p> <p>For Chrome, remember that you will also automatically be prompted to install a PWA if all the installation requirements are met.</p> <p><img src="/w2023/assets/img/chrome-a2hs-banner.f81e8479.png" alt="Chrome banner"></p> <p>This is what the banner would look like if you were not controlling the process on Chrome with the <code>beforeinstallprompt</code> event code.</p> <h3 id="how-you-can-ask-users-to-install"><a href="#how-you-can-ask-users-to-install" class="header-anchor">#</a> How you can Ask Users to Install</h3> <p>There are a number of ways that we can encourage a user to install.</p> <p>Remember, asking them too early will drive most people to ignore the option from that point onward.</p> <ol><li>A simple install button on the page. Put the button in an obvious location. Be sure to add some explanatory text about what install means. You can put this button near the bottom of the page or in
a location that appears after they have already interacted with some content on your site.</li> <li>An install button in the header of each page. Make it part of the navigation options.</li> <li>If you have a slide out navigation menu, put it at the bottom of the menu.</li> <li>A custom install banner. Have a look at the install banner that comes with chrome. Use this as a basis for creating your own styled banner that appears in any browser.</li> <li>A dismissible Snackbar near the bottom of the page. Try not to interfere with any task that the user would be trying to accomplish. You want to be noticeable without being annoying. Remember to
wait long enough before displaying.</li> <li>If there is an ordering or checkout process in your app then having an install option here is an excellent choice. As they finish their order and you are thanking them and providing a tracking
number, remind them that they can install your app and give them some reasons why they might want to.</li></ol> <p>For all of these options you have the ability to style the button to match the style of the rest of your site.</p> <p>For any of these install prompts you will need to have a screen where you outline to users, who will nearly always be less technically savvy than you, how to actually install the app.</p> <p>Read more about encouraging users to install <a href="https://web.dev/promote-install/" target="_blank" rel="noopener noreferrer">on web.dev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and more about <a href="https://web.dev/customize-install/" target="_blank" rel="noopener noreferrer">building your own install ui<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Read more about the <a href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Developer_guide/Installing" target="_blank" rel="noopener noreferrer">install process for users on different platforms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="todo-this-week"><a href="#todo-this-week" class="header-anchor">#</a> ToDo This Week</h2> <div class="custom-block danger"><p class="custom-block-title">To Do this week</p> <ul><li>read all the content for modules 5.1 and 5.2</li> <li>Complete and submit <a href="/w2023/modules/hybrids/h2/">Phase 2 of the Hybrid project</a>.</li> <li>Read through the details of the <a href="/w2023/assignments/exer/">Service Worker assignment</a>.</li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/21/2023, 8:59:47 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/w2023/modules/web-components/week5/5.1/" class="prev">
        5.1: Intro to PWA
      </a></span> <span class="next"><a href="/w2023/modules/web-components/week6/6.1/">
        6.1: Messaging &amp; Screen APIs
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/w2023/assets/js/app.49733bfc.js" defer></script><script src="/w2023/assets/js/2.e00fc094.js" defer></script><script src="/w2023/assets/js/3.1ae5a99d.js" defer></script><script src="/w2023/assets/js/9.b21c66c5.js" defer></script><script src="/w2023/assets/js/11.92cefe25.js" defer></script>
  </body>
</html>
