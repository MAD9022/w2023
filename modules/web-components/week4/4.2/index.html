<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4.2 MAD9022 | MAD9022</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Fullstack: Frontend Development Course">
    
    <link rel="preload" href="/w2023/assets/css/0.styles.33e990fb.css" as="style"><link rel="preload" href="/w2023/assets/js/app.49733bfc.js" as="script"><link rel="preload" href="/w2023/assets/js/2.e00fc094.js" as="script"><link rel="preload" href="/w2023/assets/js/43.0e1d1cc9.js" as="script"><link rel="preload" href="/w2023/assets/js/9.b21c66c5.js" as="script"><link rel="preload" href="/w2023/assets/js/11.92cefe25.js" as="script"><link rel="prefetch" href="/w2023/assets/js/10.41910312.js"><link rel="prefetch" href="/w2023/assets/js/12.b4bafa0d.js"><link rel="prefetch" href="/w2023/assets/js/13.ba803485.js"><link rel="prefetch" href="/w2023/assets/js/14.1e383464.js"><link rel="prefetch" href="/w2023/assets/js/15.bacbf527.js"><link rel="prefetch" href="/w2023/assets/js/16.e7714ee9.js"><link rel="prefetch" href="/w2023/assets/js/17.3aada0e0.js"><link rel="prefetch" href="/w2023/assets/js/18.96ead32f.js"><link rel="prefetch" href="/w2023/assets/js/19.4e5249bf.js"><link rel="prefetch" href="/w2023/assets/js/20.5dee1097.js"><link rel="prefetch" href="/w2023/assets/js/21.ec6718fa.js"><link rel="prefetch" href="/w2023/assets/js/22.fa6508dc.js"><link rel="prefetch" href="/w2023/assets/js/23.9a4c47c6.js"><link rel="prefetch" href="/w2023/assets/js/24.b2a84dff.js"><link rel="prefetch" href="/w2023/assets/js/25.85a09377.js"><link rel="prefetch" href="/w2023/assets/js/26.f1eb484c.js"><link rel="prefetch" href="/w2023/assets/js/27.25c44fa0.js"><link rel="prefetch" href="/w2023/assets/js/28.51999317.js"><link rel="prefetch" href="/w2023/assets/js/29.65075bca.js"><link rel="prefetch" href="/w2023/assets/js/3.1ae5a99d.js"><link rel="prefetch" href="/w2023/assets/js/30.5d45979f.js"><link rel="prefetch" href="/w2023/assets/js/31.22b62fdb.js"><link rel="prefetch" href="/w2023/assets/js/32.bd051bb4.js"><link rel="prefetch" href="/w2023/assets/js/33.56eaee4e.js"><link rel="prefetch" href="/w2023/assets/js/34.62593793.js"><link rel="prefetch" href="/w2023/assets/js/35.4456d2ac.js"><link rel="prefetch" href="/w2023/assets/js/36.2f2d8a40.js"><link rel="prefetch" href="/w2023/assets/js/37.5e082827.js"><link rel="prefetch" href="/w2023/assets/js/38.71855794.js"><link rel="prefetch" href="/w2023/assets/js/39.485f42ce.js"><link rel="prefetch" href="/w2023/assets/js/4.64bbff17.js"><link rel="prefetch" href="/w2023/assets/js/40.8e5ddf6e.js"><link rel="prefetch" href="/w2023/assets/js/41.fea3541d.js"><link rel="prefetch" href="/w2023/assets/js/42.d3040fe8.js"><link rel="prefetch" href="/w2023/assets/js/44.fbbee689.js"><link rel="prefetch" href="/w2023/assets/js/45.90d16594.js"><link rel="prefetch" href="/w2023/assets/js/46.fa7c6a52.js"><link rel="prefetch" href="/w2023/assets/js/47.3fb6e90a.js"><link rel="prefetch" href="/w2023/assets/js/48.2c7860fe.js"><link rel="prefetch" href="/w2023/assets/js/5.8ce5e2d0.js"><link rel="prefetch" href="/w2023/assets/js/6.a0bc34a0.js"><link rel="prefetch" href="/w2023/assets/js/7.0dc96026.js"><link rel="prefetch" href="/w2023/assets/js/8.c36795df.js">
    <link rel="stylesheet" href="/w2023/assets/css/0.styles.33e990fb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/w2023/" class="home-link router-link-active"><!----> <span class="site-name">MAD9022</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/w2023/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2023/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2023/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/w2023/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2023/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2023/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hybrid</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Web Components &amp; PWAs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/w2023/modules/web-components/week1/1.1/" class="sidebar-link">1.1: Web Components</a></li><li><a href="/w2023/modules/web-components/week2/2.1/" class="sidebar-link">2.1: Component Methods</a></li><li><a href="/w2023/modules/web-components/week2/2.2/" class="sidebar-link">2.2: Styling Components</a></li><li><a href="/w2023/modules/web-components/week3/3.1/" class="sidebar-link">3.1: Web Storage, Cookies, &amp; Cache</a></li><li><a href="/w2023/modules/web-components/week3/3.2/" class="sidebar-link">3.2: Cache, Files &amp; Responses</a></li><li><a href="/w2023/modules/web-components/week4/4.1/" class="sidebar-link">4.1: Intro to Workers</a></li><li><a href="/w2023/modules/web-components/week4/4.2/" aria-current="page" class="active sidebar-link">4.2: Service Workers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.2/#fetch-api-and-service-workers" class="sidebar-link">Fetch API And Service Workers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.2/#headers-of-requests-and-responses" class="sidebar-link">Headers of Requests and Responses</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.2/#online-and-offline-in-the-service-worker" class="sidebar-link">Online and Offline in the Service Worker</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.2/#nested-promises-and-returns" class="sidebar-link">Nested Promises and returns</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.2/#cache-put-vs-add" class="sidebar-link">Cache put() vs add()</a></li></ul></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.2/#caches-and-service-workers" class="sidebar-link">Caches and Service Workers</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.2/#indexeddb-and-service-workers" class="sidebar-link">IndexedDB and Service Workers</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.2/#todo-this-week" class="sidebar-link">ToDo This Week</a></li></ul></li><li><a href="/w2023/modules/web-components/week5/5.1/" class="sidebar-link">5.1: Intro to PWA</a></li><li><a href="/w2023/modules/web-components/week5/5.2/" class="sidebar-link">5.2: PWA Audits, Offline, &amp; Async Methods</a></li><li><a href="/w2023/modules/web-components/week6/6.1/" class="sidebar-link">6.1: Messaging &amp; Screen APIs</a></li><li><a href="/w2023/modules/web-components/week6/6.2/" class="sidebar-link">6.2: PWA Project and Review</a></li><li><a href="/w2023/modules/web-components/week7/7.1/" class="sidebar-link">7.1: PWA Project</a></li></ul></section></li><li><a href="/w2023/modules/reading/" class="sidebar-link">Reading Week</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deliverables</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title blue">
    PWA
  </div> <h1>4.2 MAD9022</h1></header> <h2 id="fetch-api-and-service-workers"><a href="#fetch-api-and-service-workers" class="header-anchor">#</a> Fetch API And Service Workers</h2> <p>By far, the most important thing you will do with a service worker is to make it work as a proxy server. A proxy server is a <code>server</code> that sits between your browser's webpage and the actual webserver
that is sending the files. It has the ability to cache files for later use, manage when new versions of the file are needed, cache data in localStorage or an indexedDB, and basically provide an
offline experience for the website.</p> <p>The first step is to add an event listener for the <code>fetch</code> event. This event is triggered EVERY time the browser sends a request for a file. Inside the event will be a Request object, which is the
Request being sent from the browser. Now, our service worker gets to decide how to handle that request.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//this function runs on every request from the browser.</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//the event object contains a request property that is a Request Object.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><a href="https://mad9014.github.io/F2022/modules/week10/ajax/#ajax" target="_blank" rel="noopener noreferrer">MAD9014 Notes on Request, Response, and other Fetch topics<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Request" target="_blank" rel="noopener noreferrer">MDN reference for Request Objects<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Response" target="_blank" rel="noopener noreferrer">MDN reference for Response Objects<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The <code>Request</code> object will contain a <code>url</code> property with the full URL of the Request, a <code>method</code> property that tells us if it was a <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>PATCH</code>, <code>DELETE</code>, <code>HEAD</code>, or <code>OPTIONS</code>
request, plus a <code>mode</code> property that tells us if the request was <code>cors</code>, <code>no-cors</code>, <code>same-origin</code>, or <code>navigate</code>. The <code>navigate</code> mode can be an important distinction. The user might be trying to leave
the website or navigate to a different page within our site. The other modes have to do with downloading files that will be used within our page.</p> <p>There is also a <code>headers</code> property that contains important meta information about the request. These might be needed to make requests to the actual Server. The <code>headers</code> can include things like the
<code>content-type</code> of the file being requested.</p> <p>Once we have the request we have many options.</p> <ol><li>Search the cache and return the file found there.</li> <li>Search the cache and if no matching file, do a fetch request for the file.</li> <li>Only forward the request on to the actual server and return a file from the server.</li> <li>Search the cache, return a file from there, and also forward the request to the server to get a new version of the requested file.</li> <li>Check if the user is online or offline and return different files based on the result.</li></ol> <p>To send anything back to the browser we would use the <code>respondWith()</code> method that can be found on the <code>fetch</code> event. The <code>respondWith()</code> method needs to be passed a <code>Response</code> object or a <code>Promise</code>
that resolves to a <code>Response</code> object.</p> <p>Here are a few examples demonstrating this.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a response object you build</span>

ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>requestObj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//a match from a cache</span>

ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//a response from a server</span>

ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token comment">/* build a response object */</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//an async function which returns a Promise</span>
  <span class="token comment">//just make sure that the function returns a Response Object</span>
  <span class="token comment">//to be wrapped by the Promise.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Here is a simple example showing a couple options.</p> <blockquote><p>Only the first <code>ev.respondWith()</code> call will actually run.</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//1. just forward the request to the actual server and back to the browser</span>
  ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//2. check the cache</span>
  <span class="token comment">// return the file from the cache if it exists</span>
  <span class="token comment">// if not, do a fetch, add to the cache and return to browser the fetched file</span>
  <span class="token comment">// remember to handle a failed fetch to the server</span>
  <span class="token comment">// pay attention to the nested `return` statements</span>
  ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cacheResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        cacheResponse <span class="token operator">||</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fetchResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//if the fetch fails...</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fetchResponse<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">//return any failed fetch to the browser if you want</span>
              <span class="token keyword">return</span> fetchResponse<span class="token punctuation">;</span>
              <span class="token comment">//or throw an error and handle it in custom ways</span>
              <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>fetchResponse<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//we have a file from the server</span>
            <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'mycache'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">,</span> fetchResponse<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">//we have to make a copy of the response to put it in the cache</span>
              <span class="token comment">//then return the file to the browser</span>
              <span class="token keyword">return</span> fetchResponse<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//had an error fetching the file</span>
            <span class="token comment">//what do you want to return to the browser request???</span>

            <span class="token comment">//a custom response</span>
            <span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'bob'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>json<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'data.json'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token literal-property property">statusText</span><span class="token operator">:</span> <span class="token string">'Ok'</span><span class="token punctuation">,</span> headers <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//a 404 error file from the cache</span>
            <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'/404.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//end of ev.respondWith()</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h3 id="headers-of-requests-and-responses"><a href="#headers-of-requests-and-responses" class="header-anchor">#</a> Headers of Requests and Responses</h3> <p>If you are using the <code>ev.request.headers</code> object to figure out what kind of request you are dealing with, then you can use its <code>get()</code> method to read any header.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>ev<span class="token punctuation">.</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//would return the value of the `content-type` header in the request object.</span>
cacheMatch<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//would return the value of the Response object that was returned from the Cache.</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//would return the value of the Response object that was returned by the fetch</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Not all servers will return a <code>Content-Type</code> header. Sometimes this can be a permission issue or a CORS issue. At other times you might have an error that prevents access to the content because the
Response object has a status code of 0. Both these issues can be resolved by adding a couple options to the <code>fetch()</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'cors'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">'omit'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//this request is attempting to make a request to a different origin</span>
  <span class="token comment">//it is not sending cookies or other credential information along with the HTTP request</span>
  <span class="token comment">//this will generally fix errors when you are getting an http status of zero.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="online-and-offline-in-the-service-worker"><a href="#online-and-offline-in-the-service-worker" class="header-anchor">#</a> Online and Offline in the Service Worker</h3> <p>When you need to check if the browser is currently offline, you can do it in the Service Worker the same way you would in your main script.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//assume that we are online</span>
<span class="token comment">//a failed fetch will tell us that we were unable to reach the server...aka offline</span>
<span class="token keyword">let</span> online <span class="token operator">=</span> <span class="token string">'isOnline'</span> <span class="token keyword">in</span> navigator <span class="token operator">?</span> navigator<span class="token punctuation">.</span>isOnline <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>With the <code>navigator.isOnline</code> property we can tell if we are completely offline. It is also possible that the user is online but has a terrible connection. In these cases, a <code>fetch()</code> call will fail
and trigger the <code>catch()</code> method. A <code>fetch()</code> call can timeout if it takes too long over the terrible connection.</p> <p>If we are using the <code>NetworkError</code> inside the first <code>fetch(url).then()</code> method then the <code>Error</code> that happens when the <code>fetch</code> is unable to reach the server will just be a standard <code>Error</code> object. This
is a good way to differentiate.</p> <p>The HTTP status code of zero or the missing <code>content-type</code> header was still the result of making a fetch call that actually communicated with a server.</p> <h3 id="nested-promises-and-returns"><a href="#nested-promises-and-returns" class="header-anchor">#</a> Nested Promises and returns</h3> <p>Inside the <code>ev.respondWith()</code> method we need to return a Promise object that contains a Response object. Sometimes this can lead to a series of nested <code>return</code> statements.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
  caches
    <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cacheResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> cacheResponse<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> type <span class="token operator">=</span> resp<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> path <span class="token operator">=</span> url<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NetworkError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to fetch </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//at this point you might want to save the fetched response in the cache</span>
            <span class="token comment">//you need to return the call to caches.open()</span>
            <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token comment">//create a copy of the fetched response to save in the cache</span>
              cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">,</span> resp<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">//then return the response</span>
              <span class="token keyword">return</span> response<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//handle the failure of the fetch</span>
            <span class="token comment">//check for Error vs NetworkError</span>
            <span class="token comment">//we should still return a Response object</span>
            <span class="token comment">//maybe an alternative item from the cache...</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//handle the error for the caches.match()</span>
      <span class="token comment">//we should still return a Response object</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="cache-put-vs-add"><a href="#cache-put-vs-add" class="header-anchor">#</a> Cache put() vs add()</h3> <p>A <code>cache</code> object has a <code>put(request, response)</code> and a <code>add(request)</code> method. Both will save a file <code>Response</code> to the <code>Cache</code>. The difference between them is that the <code>put</code> method <strong>ONLY</strong> saves a
<code>Response</code> to the <code>Cache</code> using the <code>Request</code> as the key. The <code>add</code> method will make an HTTP request to the server to get the file and then save the <code>Response</code> in the <code>Cache</code>. If you already have a
<code>Response</code> object then use the <code>put</code> method.</p> <div title="handling errors in promises" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/LzlGL3k3p04" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div title="try catch throw" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/_am9rKw4vWw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div title="Building Custom Promise-based Functions" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/rmrIl603zVM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="caches-and-service-workers"><a href="#caches-and-service-workers" class="header-anchor">#</a> Caches and Service Workers</h2> <p>We talked about the Cache API back in week 3.</p> <p>Service Workers can access caches the same way that a regular script would. Service Workers typically use caches to save files that will be used to cache data files fetched from the server as well as
saving files that can be used if the web app is offline and can't access the server.</p> <p>With a Service Worker we have the <code>install</code>, <code>activate</code>, and <code>fetch</code> events. We do different things with the Cache from inside each of these events.</p> <p><strong>install event</strong> - This is the time to add an array of files to the cache that will be needed if offline.</p> <p><strong>activate event</strong> - This is the time to delete older versions of the cache that are no longer needed.</p> <p><strong>fetch event</strong> - This is the time to add a single file to the cache, if there is an updated version of the file, or if you want to save a new file that was not previously in the cache.</p> <p>For any of these to work we need to first get a reference to the cache with <code>caches.open(cacheName)</code>. This returns a Promise that contains the reference to the cache with the specified name.</p> <p>The <code>install</code> and <code>activate</code> events will use the <code>ev.waitUntil()</code> method to wait for the Promise to be resolved, similar to the <code>await</code> keyword. This way we are able to finish working with the Cache
before the function stops running.</p> <p>In the <code>fetch</code> event we will use the <code>ev.respondWith()</code> method to handle asynchronous fetch calls and send a response back to the browser.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> cacheName <span class="token operator">=</span> <span class="token string">'aUniqueCacheName'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> cacheList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//an array of files to save in the cache</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//save the list of files in the cache</span>
  ev<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      cache
        <span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>cacheList<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">//all the files were saved in the cache</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">//at least one file failed to be written to the cache</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>Each of the entries in the Cache can be either a URL or a Response object.</p> <p>In the <code>activate</code> event we need to get a list of all the names of all the caches. We do this with the <code>keys()</code> event which returns a Promise that contains an array of all the cache names.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ev<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">nm</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> nm <span class="token operator">!=</span> cacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">nm</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> caches<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>nm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>In the <code>fetch</code> listener function we are handling files, one at a time. For each file you will have to make decisions by looking at the file name, looking at the headers, checking the the current
online|offline status and more.</p> <p>The <code>fetch</code> event object has a <code>request</code> property. This is a <code>Request</code> object like any other. It has a <code>url</code> property and a <code>headers</code> property.</p> <p>Inside the listener function we will check in the cache for files by passing a <code>Request</code> object or a url string to a <code>caches.match()</code> method. We can use <code>caches</code> because we are going to search through
all current cache objects.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cacheMatch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//the cacheMatch variable is a Response object that came out of the cache</span>
  <span class="token comment">//it matched whatever Request object was in the event object.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>If there is no match in the Cache for <code>ev.request</code> then the cacheMatch object will contain <code>null</code>. You can use this to decide if you want to return a match from the cache or if you need to do a
<code>fetch()</code> call.</p> <p>The video below is an examination of how the Cache API can be used in connection with Service Workers.</p> <div title="From the Service Worker playlist - Cache API" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/Gu0t2EW2kfU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <p>This second video is how to use the caches from inside a Service Worker to keep things in sync with the Service Worker Life Cycle.</p> <div title="From the Service Worker playlist - Cache API &amp; Service Worker" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZoucFUOHGhk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="indexeddb-and-service-workers"><a href="#indexeddb-and-service-workers" class="header-anchor">#</a> IndexedDB and Service Workers</h2> <p>If you want to learn about using a local document database in the browser, there is a built-in one called <code>IndexedDB</code>.</p> <p><code>IndexedDB</code> is a JSON-like database that you create in your browser and can use to store local information, similar to what you do with LocalStorage. The difference between IndexedDB and LocalStorage
is that IndexedDB can hold more data and your script can search through the data and modify it. With IndexedDB, you don't have to download all the data and parse it before searching through the data
for values or to modify or delete parts of the data.</p> <p><a href="https://www.youtube.com/watch?v=6fK1K28eoUA&amp;list=PLyuRouwmQCjmNyAysdqjNz5fIS5cYU4vi" target="_blank" rel="noopener noreferrer">Here is a full playlist of videos about how to use IndexedDB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>This is the first video in that playlist:</p> <div title="IndexedDB Part 1 Intro" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/gb5ovg7YCig" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div title="From the Service Worker playlist - Integrating IndexedDB" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/4NkDiGd0mWc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="todo-this-week"><a href="#todo-this-week" class="header-anchor">#</a> ToDo This Week</h2> <div class="custom-block danger"><p class="custom-block-title">To Do this week</p> <ul><li>read all the content for modules 4.1 and 4.2</li> <li>Complete and submit the <a href="/w2023/assignments/exer/">Cache API assignment</a>.</li> <li>Read through the details of the <a href="/w2023/assignments/exer/">Service Worker assignment</a>.</li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/5/2023, 8:29:43 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/w2023/modules/web-components/week4/4.1/" class="prev">
        4.1: Intro to Workers
      </a></span> <span class="next"><a href="/w2023/modules/web-components/week5/5.1/">
        5.1: Intro to PWA
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/w2023/assets/js/app.49733bfc.js" defer></script><script src="/w2023/assets/js/2.e00fc094.js" defer></script><script src="/w2023/assets/js/43.0e1d1cc9.js" defer></script><script src="/w2023/assets/js/9.b21c66c5.js" defer></script><script src="/w2023/assets/js/11.92cefe25.js" defer></script>
  </body>
</html>
