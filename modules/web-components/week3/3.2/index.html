<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3.2 MAD9022 | MAD9022</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Fullstack: Frontend Development Course">
    
    <link rel="preload" href="/w2023/assets/css/0.styles.33e990fb.css" as="style"><link rel="preload" href="/w2023/assets/js/app.49733bfc.js" as="script"><link rel="preload" href="/w2023/assets/js/2.e00fc094.js" as="script"><link rel="preload" href="/w2023/assets/js/42.d3040fe8.js" as="script"><link rel="preload" href="/w2023/assets/js/9.b21c66c5.js" as="script"><link rel="preload" href="/w2023/assets/js/11.92cefe25.js" as="script"><link rel="prefetch" href="/w2023/assets/js/10.41910312.js"><link rel="prefetch" href="/w2023/assets/js/12.b4bafa0d.js"><link rel="prefetch" href="/w2023/assets/js/13.ba803485.js"><link rel="prefetch" href="/w2023/assets/js/14.1e383464.js"><link rel="prefetch" href="/w2023/assets/js/15.bacbf527.js"><link rel="prefetch" href="/w2023/assets/js/16.e7714ee9.js"><link rel="prefetch" href="/w2023/assets/js/17.3aada0e0.js"><link rel="prefetch" href="/w2023/assets/js/18.96ead32f.js"><link rel="prefetch" href="/w2023/assets/js/19.4e5249bf.js"><link rel="prefetch" href="/w2023/assets/js/20.5dee1097.js"><link rel="prefetch" href="/w2023/assets/js/21.ec6718fa.js"><link rel="prefetch" href="/w2023/assets/js/22.fa6508dc.js"><link rel="prefetch" href="/w2023/assets/js/23.9a4c47c6.js"><link rel="prefetch" href="/w2023/assets/js/24.b2a84dff.js"><link rel="prefetch" href="/w2023/assets/js/25.85a09377.js"><link rel="prefetch" href="/w2023/assets/js/26.f1eb484c.js"><link rel="prefetch" href="/w2023/assets/js/27.25c44fa0.js"><link rel="prefetch" href="/w2023/assets/js/28.51999317.js"><link rel="prefetch" href="/w2023/assets/js/29.65075bca.js"><link rel="prefetch" href="/w2023/assets/js/3.1ae5a99d.js"><link rel="prefetch" href="/w2023/assets/js/30.5d45979f.js"><link rel="prefetch" href="/w2023/assets/js/31.22b62fdb.js"><link rel="prefetch" href="/w2023/assets/js/32.bd051bb4.js"><link rel="prefetch" href="/w2023/assets/js/33.56eaee4e.js"><link rel="prefetch" href="/w2023/assets/js/34.62593793.js"><link rel="prefetch" href="/w2023/assets/js/35.4456d2ac.js"><link rel="prefetch" href="/w2023/assets/js/36.2f2d8a40.js"><link rel="prefetch" href="/w2023/assets/js/37.5e082827.js"><link rel="prefetch" href="/w2023/assets/js/38.71855794.js"><link rel="prefetch" href="/w2023/assets/js/39.485f42ce.js"><link rel="prefetch" href="/w2023/assets/js/4.64bbff17.js"><link rel="prefetch" href="/w2023/assets/js/40.8e5ddf6e.js"><link rel="prefetch" href="/w2023/assets/js/41.fea3541d.js"><link rel="prefetch" href="/w2023/assets/js/43.0e1d1cc9.js"><link rel="prefetch" href="/w2023/assets/js/44.fbbee689.js"><link rel="prefetch" href="/w2023/assets/js/45.90d16594.js"><link rel="prefetch" href="/w2023/assets/js/46.fa7c6a52.js"><link rel="prefetch" href="/w2023/assets/js/47.3fb6e90a.js"><link rel="prefetch" href="/w2023/assets/js/48.2c7860fe.js"><link rel="prefetch" href="/w2023/assets/js/5.8ce5e2d0.js"><link rel="prefetch" href="/w2023/assets/js/6.a0bc34a0.js"><link rel="prefetch" href="/w2023/assets/js/7.0dc96026.js"><link rel="prefetch" href="/w2023/assets/js/8.c36795df.js">
    <link rel="stylesheet" href="/w2023/assets/css/0.styles.33e990fb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/w2023/" class="home-link router-link-active"><!----> <span class="site-name">MAD9022</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/w2023/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2023/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2023/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/w2023/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2023/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2023/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hybrid</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Web Components &amp; PWAs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/w2023/modules/web-components/week1/1.1/" class="sidebar-link">1.1: Web Components</a></li><li><a href="/w2023/modules/web-components/week2/2.1/" class="sidebar-link">2.1: Component Methods</a></li><li><a href="/w2023/modules/web-components/week2/2.2/" class="sidebar-link">2.2: Styling Components</a></li><li><a href="/w2023/modules/web-components/week3/3.1/" class="sidebar-link">3.1: Web Storage, Cookies, &amp; Cache</a></li><li><a href="/w2023/modules/web-components/week3/3.2/" aria-current="page" class="active sidebar-link">3.2: Cache, Files &amp; Responses</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week3/3.2/#files-and-blobs" class="sidebar-link">Files and Blobs</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week3/3.2/#request-and-response-objects" class="sidebar-link">Request and Response Objects</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week3/3.2/#cache-api" class="sidebar-link">Cache API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week3/3.2/#saving-files-in-cache" class="sidebar-link">Saving Files in Cache</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week3/3.2/#retrieving-files-from-cache" class="sidebar-link">Retrieving Files from Cache</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week3/3.2/#list-of-files-in-cache" class="sidebar-link">List of Files in Cache</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week3/3.2/#delete-caches-or-files" class="sidebar-link">Delete Caches or Files</a></li></ul></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week3/3.2/#todo-this-week" class="sidebar-link">ToDo This Week</a></li></ul></li><li><a href="/w2023/modules/web-components/week4/4.1/" class="sidebar-link">4.1: Intro to Workers</a></li><li><a href="/w2023/modules/web-components/week4/4.2/" class="sidebar-link">4.2: Service Workers</a></li><li><a href="/w2023/modules/web-components/week5/5.1/" class="sidebar-link">5.1: Intro to PWA</a></li><li><a href="/w2023/modules/web-components/week5/5.2/" class="sidebar-link">5.2: PWA Audits, Offline, &amp; Async Methods</a></li><li><a href="/w2023/modules/web-components/week6/6.1/" class="sidebar-link">6.1: Messaging &amp; Screen APIs</a></li><li><a href="/w2023/modules/web-components/week6/6.2/" class="sidebar-link">6.2: PWA Project and Review</a></li><li><a href="/w2023/modules/web-components/week7/7.1/" class="sidebar-link">7.1: PWA Project</a></li></ul></section></li><li><a href="/w2023/modules/reading/" class="sidebar-link">Reading Week</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deliverables</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title blue">
    PWA
  </div> <h1>3.2 MAD9022</h1></header> <h2 id="files-and-blobs"><a href="#files-and-blobs" class="header-anchor">#</a> Files and Blobs</h2> <p>When we are going to save things with the Cache API we need to have a Response object and inside each Response object is a File.</p> <p>A File and a Blob (Binary Large OBject) are essentially the same thing. Both are a container for a bunch of binary data. The difference is that a File has a set of defined properties - file name, file
type, file size. The file type is the Mime-Type. Eg: 'application/json', 'text/css', 'image/png'.</p> <p>A Blob or a File can be created from a typedArray or ArrayBuffer. A File can also come from a form that includes an <code>&lt;input type=&quot;file&quot; /&gt;</code>. When you get the value of an input with type=&quot;file&quot;, you
will get a FileList object that could be empty or it could contain one or more file objects.</p> <p>If you have built or received a TypedArray or ArrayBuffer then you can build your own Blob or File. You can even turn a Blob into a File by passing the Blob to a File constructor and providing a file
name and type.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">,</span> filename<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">,</span> <span class="token literal-property property">lastModified</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> file2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>blob<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'somefile.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text/plain'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>For more detailed information about creating and working with Blobs and Files watch these two videos.</p> <div title="File and FileList Objects" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/7fybEXre70o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div title="Deep Dive into Files, Blobs, and ArrayBuffers" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/ScZZoHj7mqY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="request-and-response-objects"><a href="#request-and-response-objects" class="header-anchor">#</a> Request and Response Objects</h2> <p>When we make <code>fetch</code> calls we get back a <code>Response</code> object. From the <code>Response</code> we can get the status code, the status message, and we can extract the json data, the text or the Blob.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//response is a Response object</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//obj would be an object built from the JSON string in the response</span>
    <span class="token comment">//or the Blob extracted from the response</span>
    <span class="token comment">//or the text content of a css, js, html, txt, rtf, or xml file</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>So, if our Response object comes from a <code>fetch</code>, then it is easy enough to put that Response into a <code>Cache</code>.</p> <p>However, if you have a File that comes from some other source, like a file input, then we need to create a Response object ourselves.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> filelist <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myAvatarImage'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token keyword">let</span> file <span class="token operator">=</span> filelist<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
h<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
h<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'Content-Length'</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
h<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'X-custom-header'</span><span class="token punctuation">,</span> <span class="token string">'some value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token literal-property property">statusText</span><span class="token operator">:</span> <span class="token string">'All Good'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> h<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Once you have the <code>Response</code> object, then you can put it into your <code>Cache</code>.</p> <p>For more details watch the short video below (same as the video in Module 3.1).</p> <div title="Building Custom Response Objects" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/HlI4-hVmGT4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="cache-api"><a href="#cache-api" class="header-anchor">#</a> Cache API</h2> <p>Added as part of HTML5, the <code>Cache API</code> lets javascript developers intentionally save files, including data files, in the browser to improve performance and reduce latency for repeated future visits.</p> <p>The <code>Cache API</code> is separate from the built-in browser cache that is controlled by the browser and HTTP Request and Response Headers.</p> <p>When building a cache, the main reason you would want one is to be able to run your website when the network fails or the user turns off their wifi. We want our app to be able to run offline after the
initial load.</p> <p>While the <code>Cache API</code> is primarily used from Service Workers for Progressive Web Apps, we can also use it directly from any webpage. (We will be talking about Service Workers soon).</p> <p>It is based on <a href="https://www.youtube.com/watch?v=SmPouEFKOBg&amp;list=PLyuRouwmQCjngZXVn48vYmPK_1yAF-fLw" target="_blank" rel="noopener noreferrer">Promises<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, just like the <code>Fetch API</code>.</p> <p>The following video gives examples of how to pull files from forms, how to extract files from the Cache, how to put files into the Cache, how to copy files, how to render files to the page, and how to
dynamic create new files from data.</p> <div title="File Handling in Web Apps" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/zq2xD-xuIG4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h3 id="saving-files-in-cache"><a href="#saving-files-in-cache" class="header-anchor">#</a> Saving Files in Cache</h3> <p>When you want to save files in the cache to use later on, you first need to call the asynchronous method <code>caches.open(cacheName)</code>. It returns a promise that will resolve to a cache object that
references the specific cache you opened. The <code>cacheName</code> is a String used as the reference name for a single cache. You can have as many caches as you want attached to your origin. They must each
have a unique name.</p> <p>Following that, we call the <code>cache.add()</code> method, which will accept one of the following:</p> <ul><li>a <code>String</code> of a URL</li> <li>a <code>URL</code> object</li> <li>a <code>Request</code> object</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> cacheName <span class="token operator">=</span> <span class="token string">'myCache-v1'</span><span class="token punctuation">;</span> <span class="token comment">//key name for our cache</span>
<span class="token keyword">let</span> assets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/img/demo.jpg'</span><span class="token punctuation">,</span> <span class="token string">'/img/other.jpg'</span><span class="token punctuation">,</span> <span class="token string">'/img/joanne.png'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//an array of files to save in our cache</span>

caches
  <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> urlString <span class="token operator">=</span> <span class="token string">'/img/1011-800x600.jpg?id=one'</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>urlString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//add = fetch + put</span>

    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:5500/img/1011-800x600.jpg?id=two'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'/img/1011-800x600.jpg?id=three'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//cache.addAll(assets).then() is an alternative that lets you save a list</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//the open method failed.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>In this example we are saving three copies of the same file (an image called <code>1011-800x600.jpg</code>) into our cache. This could have been three different files. This code is just to illustrate that
changing the querystring value makes the browser view it as 3 different files.</p> <p>If you want to have an array of file names you could call the <code>cache.addAll</code> method and pass in the array. The current domain name will be prepended to all those strings when the requests are made,
unless another protocol and domain are used at the start of the string.</p> <p>The <code>cache</code> object also has <code>fetch</code> and <code>put</code> methods. The <code>fetch</code> method will download the file. The <code>put</code> method will save the file in the HTTP Response in the cache. The <code>add</code> method does both the
<code>fetch</code> and <code>put</code> steps together.</p> <p>If you already have a <code>Response</code> object or a <code>File</code> object that can be wrapped in a <code>Response</code> object then you can use the <code>put</code> method instead of the <code>add</code> method. Remember that the <code>cache.add(url)</code>
will make a fetch call and save the response in the Cache. If your browser is offline then you will not be able to fetch the url. There will be times when you will already have your file to save in
the cache. In these cases you can use <code>put</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello world'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'sample.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text/plain'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> resp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token literal-property property">statusText</span><span class="token operator">:</span> <span class="token string">'Ok'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

caches
  <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'./fake/data/folder/sample.txt'</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//you can make up whatever path you want to use as the URL for your response.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>If you ever need to remove something from the cache then you can call the <code>cache.delete(reference)</code> method to remove the file. It takes a <code>Request</code>, <code>URL</code> or <code>USVString</code>, which represent the file, as
an argument. It returns a Promise that resolves when the file has been deleted.</p> <div title="The Cache API from a Service Worker" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/Gu0t2EW2kfU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h3 id="retrieving-files-from-cache"><a href="#retrieving-files-from-cache" class="header-anchor">#</a> Retrieving Files from Cache</h3> <p>When you want to read a file from the cache then we use the <code>cache.match()</code> method. It will return a <code>Response</code> object, just like a <code>fetch</code> call would. The difference is that it is looking at the
internal browser cache for your domain under the key used to create the <code>cache</code> object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//the request argument can be a USVString, a URL object, or a Request object</span>
<span class="token comment">//the options argument is optional. It is an object with 3 properties</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">ignoreSearch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//ignore the queryString</span>
  <span class="token literal-property property">ignoreMethod</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//ignore the method - POST, GET, etc</span>
  <span class="token literal-property property">ignoreVary</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//ignore if the response has a VARY header</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
cache
  <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something with the response object... just like you would with fetch</span>
    <span class="token comment">// if(! response.ok) throw new Error(response.statusText)</span>
    <span class="token comment">// response.json()</span>
    <span class="token comment">// response.blob()</span>
    <span class="token comment">// response.text()</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//do something with the contents of the Response that was pulled from the Cache</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="list-of-files-in-cache"><a href="#list-of-files-in-cache" class="header-anchor">#</a> List of Files in Cache</h3> <p>The Cache API also includes a <code>keys()</code> method which returns a <code>Promise</code> that will resolve to an Array of <code>Response</code> objects inside the selected cache.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>caches
  <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//keys is the array of responses in the `cache`.</span>
    keys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//output the url of the request</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>warn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>If you want to retrieve a file you can always use the <code>cache.match()</code> method. If you want to retrieve multiple files then you can use the <code>cache.matchAll()</code> method.</p> <h3 id="delete-caches-or-files"><a href="#delete-caches-or-files" class="header-anchor">#</a> Delete Caches or Files</h3> <p>To delete a single file from the cache need a reference to the cache that contains the file and then, with the name of the file call the <code>delete</code> asynchronous method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deleteFile</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  caches
    <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//delete is complete</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>However, if you plan to delete multiple files from the cache then you need to wait for all the deletes to be successful. In these cases, <code>Promise.all()</code> is the approach you need. The <code>Promise.all</code>
method expects to be passed an array of promises. So, an array of calls to <code>cache.delete()</code> would be this.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//delete these three files from the cache &quot;cacheName&quot;</span>
<span class="token keyword">let</span> filesToDelete <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'one.jpg'</span><span class="token punctuation">,</span> <span class="token string">'two.html'</span><span class="token punctuation">,</span> <span class="token string">'three.css'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

caches
  <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'cacheName'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
      filesToDelete<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        cache<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//successfully deleted all those files</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>warn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p>NOTE: If <code>caches.keys()</code> is called, on the <code>caches</code> object, then the Array contains a list of the cache names. If <code>cache.keys()</code> is called then the Array will contain a list of the <code>Request</code> objects
in that specific cache.</p></blockquote> <p>If you are looking to delete one or more caches, not just individual files, then you can use the same approach with the <code>Promise.all()</code> around the call to <code>caches.keys()</code> and then a <code>filter().map()</code>
to delete multiple caches.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//to delete multiple caches except the ones</span>
<span class="token comment">// in cache1 and cache2</span>
Promises<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
  caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> keys<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">nm</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> nm <span class="token operator">!==</span> cache1 <span class="token operator">&amp;&amp;</span> nm <span class="token operator">!==</span> cache2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">nm</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> caches<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>nm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="todo-this-week"><a href="#todo-this-week" class="header-anchor">#</a> ToDo This Week</h2> <div class="custom-block danger"><p class="custom-block-title">To Do this week</p> <ul><li>read all the content for modules 3.1 and 3.2</li> <li>Complete and submit <a href="/w2023/modules/hybrids/h1/">Phase 1 of the Hybrid Project</a>.</li> <li>Start working on the <a href="/w2023/assignments/exer/">Cache API exercise</a>.</li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/31/2023, 8:25:56 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/w2023/modules/web-components/week3/3.1/" class="prev">
        3.1: Web Storage, Cookies, &amp; Cache
      </a></span> <span class="next"><a href="/w2023/modules/web-components/week4/4.1/">
        4.1: Intro to Workers
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/w2023/assets/js/app.49733bfc.js" defer></script><script src="/w2023/assets/js/2.e00fc094.js" defer></script><script src="/w2023/assets/js/42.d3040fe8.js" defer></script><script src="/w2023/assets/js/9.b21c66c5.js" defer></script><script src="/w2023/assets/js/11.92cefe25.js" defer></script>
  </body>
</html>
