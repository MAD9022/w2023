<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4.1 MAD9022 | MAD9022</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Fullstack: Frontend Development Course">
    
    <link rel="preload" href="/w2023/assets/css/0.styles.33e990fb.css" as="style"><link rel="preload" href="/w2023/assets/js/app.49733bfc.js" as="script"><link rel="preload" href="/w2023/assets/js/2.e00fc094.js" as="script"><link rel="preload" href="/w2023/assets/js/15.bacbf527.js" as="script"><link rel="preload" href="/w2023/assets/js/9.b21c66c5.js" as="script"><link rel="preload" href="/w2023/assets/js/11.92cefe25.js" as="script"><link rel="prefetch" href="/w2023/assets/js/10.41910312.js"><link rel="prefetch" href="/w2023/assets/js/12.b4bafa0d.js"><link rel="prefetch" href="/w2023/assets/js/13.ba803485.js"><link rel="prefetch" href="/w2023/assets/js/14.1e383464.js"><link rel="prefetch" href="/w2023/assets/js/16.e7714ee9.js"><link rel="prefetch" href="/w2023/assets/js/17.3aada0e0.js"><link rel="prefetch" href="/w2023/assets/js/18.96ead32f.js"><link rel="prefetch" href="/w2023/assets/js/19.4e5249bf.js"><link rel="prefetch" href="/w2023/assets/js/20.5dee1097.js"><link rel="prefetch" href="/w2023/assets/js/21.ec6718fa.js"><link rel="prefetch" href="/w2023/assets/js/22.fa6508dc.js"><link rel="prefetch" href="/w2023/assets/js/23.9a4c47c6.js"><link rel="prefetch" href="/w2023/assets/js/24.b2a84dff.js"><link rel="prefetch" href="/w2023/assets/js/25.85a09377.js"><link rel="prefetch" href="/w2023/assets/js/26.f1eb484c.js"><link rel="prefetch" href="/w2023/assets/js/27.25c44fa0.js"><link rel="prefetch" href="/w2023/assets/js/28.51999317.js"><link rel="prefetch" href="/w2023/assets/js/29.65075bca.js"><link rel="prefetch" href="/w2023/assets/js/3.1ae5a99d.js"><link rel="prefetch" href="/w2023/assets/js/30.5d45979f.js"><link rel="prefetch" href="/w2023/assets/js/31.22b62fdb.js"><link rel="prefetch" href="/w2023/assets/js/32.bd051bb4.js"><link rel="prefetch" href="/w2023/assets/js/33.56eaee4e.js"><link rel="prefetch" href="/w2023/assets/js/34.62593793.js"><link rel="prefetch" href="/w2023/assets/js/35.4456d2ac.js"><link rel="prefetch" href="/w2023/assets/js/36.2f2d8a40.js"><link rel="prefetch" href="/w2023/assets/js/37.5e082827.js"><link rel="prefetch" href="/w2023/assets/js/38.71855794.js"><link rel="prefetch" href="/w2023/assets/js/39.485f42ce.js"><link rel="prefetch" href="/w2023/assets/js/4.64bbff17.js"><link rel="prefetch" href="/w2023/assets/js/40.8e5ddf6e.js"><link rel="prefetch" href="/w2023/assets/js/41.fea3541d.js"><link rel="prefetch" href="/w2023/assets/js/42.d3040fe8.js"><link rel="prefetch" href="/w2023/assets/js/43.0e1d1cc9.js"><link rel="prefetch" href="/w2023/assets/js/44.fbbee689.js"><link rel="prefetch" href="/w2023/assets/js/45.90d16594.js"><link rel="prefetch" href="/w2023/assets/js/46.fa7c6a52.js"><link rel="prefetch" href="/w2023/assets/js/47.3fb6e90a.js"><link rel="prefetch" href="/w2023/assets/js/48.2c7860fe.js"><link rel="prefetch" href="/w2023/assets/js/5.8ce5e2d0.js"><link rel="prefetch" href="/w2023/assets/js/6.a0bc34a0.js"><link rel="prefetch" href="/w2023/assets/js/7.0dc96026.js"><link rel="prefetch" href="/w2023/assets/js/8.c36795df.js">
    <link rel="stylesheet" href="/w2023/assets/css/0.styles.33e990fb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/w2023/" class="home-link router-link-active"><!----> <span class="site-name">MAD9022</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/w2023/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2023/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2023/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/w2023/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2023/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2023/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hybrid</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Web Components &amp; PWAs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/w2023/modules/web-components/week1/1.1/" class="sidebar-link">1.1: Web Components</a></li><li><a href="/w2023/modules/web-components/week2/2.1/" class="sidebar-link">2.1: Component Methods</a></li><li><a href="/w2023/modules/web-components/week2/2.2/" class="sidebar-link">2.2: Styling Components</a></li><li><a href="/w2023/modules/web-components/week3/3.1/" class="sidebar-link">3.1: Web Storage, Cookies, &amp; Cache</a></li><li><a href="/w2023/modules/web-components/week3/3.2/" class="sidebar-link">3.2: Cache, Files &amp; Responses</a></li><li><a href="/w2023/modules/web-components/week4/4.1/" aria-current="page" class="active sidebar-link">4.1: Intro to Workers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.1/#workers" class="sidebar-link">Workers</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.1/#web-workers-and-shared-web-workers" class="sidebar-link">Web Workers and Shared Web Workers</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.1/#registering-and-installing-service-workers" class="sidebar-link">Registering and Installing Service Workers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.1/#life-cycle-for-service-workers" class="sidebar-link">Life-cycle for Service Workers</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.1/#dev-tools-for-service-workers" class="sidebar-link">Dev Tools for Service Workers</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.1/#service-worker-playlist" class="sidebar-link">Service Worker Playlist</a></li></ul></li><li class="sidebar-sub-header"><a href="/w2023/modules/web-components/week4/4.1/#todo-this-week" class="sidebar-link">ToDo This Week</a></li></ul></li><li><a href="/w2023/modules/web-components/week4/4.2/" class="sidebar-link">4.2: Service Workers</a></li><li><a href="/w2023/modules/web-components/week5/5.1/" class="sidebar-link">5.1: Intro to PWA</a></li><li><a href="/w2023/modules/web-components/week5/5.2/" class="sidebar-link">5.2: PWA Audits, Offline, &amp; Async Methods</a></li><li><a href="/w2023/modules/web-components/week6/6.1/" class="sidebar-link">6.1: Messaging &amp; Screen APIs</a></li><li><a href="/w2023/modules/web-components/week6/6.2/" class="sidebar-link">6.2: PWA Project and Review</a></li><li><a href="/w2023/modules/web-components/week7/7.1/" class="sidebar-link">7.1: PWA Project</a></li></ul></section></li><li><a href="/w2023/modules/reading/" class="sidebar-link">Reading Week</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deliverables</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title blue">
    PWA
  </div> <h1>4.1 MAD9022</h1></header> <h2 id="workers"><a href="#workers" class="header-anchor">#</a> Workers</h2> <p>Workers are a special kind of JavaScript file that uses a new thread for processing the script.</p> <p>If you have a webpage with three <code>&lt;script&gt;</code> tags, then all three of those scripts are loaded into the same thread which is created for the current domain.</p> <p>If you create a worker script then it will create a second thread for the domain and run there. It can be a useful way to offload some processor intensive tasks.</p> <p>There are three kinds of shared workers. They are called shared because they can be accessed by all other scripts that are running in the browser across all windows and tabs that are loading pages
from the same domain.</p> <p>The first type is a <code>Worklet</code>. These are specifically for tasks related to Audio processing, CSS and rendering of the UI. We won't be using any Worklets in our courses.
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Worklet" target="_blank" rel="noopener noreferrer">Here is a reference for Worklets<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The second kind is called a <code>Web Worker</code>. These are very general workers meant for any processing task that you want. The Worker gets launched by the web page's current script and only run while the
page is active. They cannot access the DOM for the current page. However, they are capable of passing messages back and forth between the worker and the page.</p> <p>The third kind is called a <code>Service Worker</code>. The service workers are more useful and are key to building Progressive Web Applications (PWA). These are shared scripts that are installed by the current
webpage and they stay installed for future visits. They work like proxy servers and intercept every HTTP Request that comes from the web page and every HTTP Response that comes from the web server.
They can access the Cache API, LocalStorage, IndexedDB, and Cookies for the current domain. They cannot access the DOM for the current webpage. They are capable of passing messages back and forth
between the worker and the page.</p> <p>Here is a <a href="https://bitsofco.de/web-workers-vs-service-workers-vs-worklets/" target="_blank" rel="noopener noreferrer">great article<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> about the differences between Service Workers, Web Workers, and Worklets. All three are <code>workers</code> meaning
that they get launched from a webpage script and they run on a separate thread to offload some processor intensive work.</p> <h2 id="web-workers-and-shared-web-workers"><a href="#web-workers-and-shared-web-workers" class="header-anchor">#</a> Web Workers and Shared Web Workers</h2> <p>By now we are very familiar with the idea that JavaScript runs the main stack on a single thread. This means that the main stack runs in a synchronous way - one task at a time.</p> <p>We do have asynchronous things like Events, Timers, and Promises which will be placed on another thread to be handled. When they are ready to be used they get put in a queue to wait to be added back
onto the main stack. They can only be added back onto the main stack when it is empty and all the current tasks are complete.</p> <p>So, if you have a processor intensive task to complete but it isn't connected to a Promise, Timer, or Event then you are stuck with the main stack not able to do anything until it finishes this big
task. Updating the interface and interacting with the user in a real-time way could be jeopardized.</p> <p>The solution? Web Workers. With these, we can actually create our own new thread to use and run our complex task on that other thread. Our main stack will, once again, be free to work with the
interface and the user. Web Workers can contain practically any code we want, except it is not allow to access the DOM (the interface).</p> <p>There are actually two kinds of Web Workers. The standard Web Worker and a Shared Web Worker.</p> <p><strong>Shared Web Workers</strong> are workers that can be utilized by multiple scripts running in different windows, IFrames, etc., as long as they are in the same domain as the worker. They are a little more
complex than dedicated workers — scripts must communicate via an active port.</p> <div title="Shared Web Workers" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/EiPytIxrZtU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="registering-and-installing-service-workers"><a href="#registering-and-installing-service-workers" class="header-anchor">#</a> Registering and Installing Service Workers</h2> <p>The last kind of worker is a Service Worker. These are external javascript files that are designed to run in the background behind all the pages for your origin. They are not allowed to touch the DOM
but they can work with <code>fetch()</code>, the Cache API, and IndexedDB. This makes them perfect to use as a Proxy Server that manages the contents of your web site and that is responsible for storing data and
backups.</p> <p>They are also one of the requirements for building a Progressive Web App (our eventual goal).</p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API" target="_blank" rel="noopener noreferrer">MDN Reference for the Service Worker API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Service Workers are Event driven, meaning that events are the trigger for any of its code to run. Everything that you do in a Service Worker is also asynchronous, they make heavy use of Promises. So,
synchronous APIs like XHR and WebStorage and DOM are not accessible.</p> <p>Outside of <code>localhost</code>, https must be used with Service Workers.</p> <p>In Firefox, Service Workers, like the Cache API, will not run in Private Browser Mode.</p> <p>Registering a service worker for your website can be quite simple.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/service-worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The <code>serviceWorker</code> object exists inside the <code>window.navigator</code> object. You can call the file that holds your service worker anything that you want but it should be saved at the root of your website.</p> <p>When you register the file it will automatically be applied to EVERY tab and EVERY webpage under the current domain.</p> <p>If you are working on a project that is running in Chrome under <code>http://127.0.0.1:5500</code> and you register a Service Worker then it will remain there and apply to every webpage from <code>http://127.0.0.1/</code>
that you open on Chrome until you remove it yourself through the Chrome Dev tools.</p> <p>If you want to see if a Service Worker is currently running for your webpage, you can use this:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do a check to see if a service worker is in control.</span>
  navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>ready<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">registration</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">A service worker is active: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>registration<span class="token punctuation">.</span>active<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// At this point, you can call methods that require an active</span>
    <span class="token comment">// service worker, like registration.pushManager.subscribe()</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">This page is currently controlled by: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>controller<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This page is not currently controlled by a service worker.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Service workers are not supported.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>In some other code samples and in the videos you will see the <code>navigator.serviceWorker.controller</code> as well as the <code>controllerchange</code> event being used.</p> <div class="custom-block tip"><p class="custom-block-title">Best Practice</p> <p>The Promise-based <code>navigator.serviceWorker.ready</code> is a better way to have your code wait for access to a controller.</p></div> <h3 id="life-cycle-for-service-workers"><a href="#life-cycle-for-service-workers" class="header-anchor">#</a> Life-cycle for Service Workers</h3> <p>The life cycle for service workers has two critical events <code>install</code> and <code>activate</code>. When you call the <code>register</code> method for the service worker, the browser will check to see if this specific file has
previously been installed. If not, then it will install it and trigger the <code>install</code> event.</p> <p>If the file was previously installed but there is a change to the code inside the file then it will trigger a new installation of the script. Service workers are installed for a specific domain. They
are tied to the current domain.</p> <p>The <code>activate</code> event happens when a service worker has been installed and there is no other service worker currently running on any tab in the browser for the current domain. As long as there is still
an older service worker running, the browser will not want to active the new file or new version.</p> <p>If you load your webpage once and the browser <code>install</code>s and <code>activate</code>s a service worker, then you edit the service worker and reload your webpage, the browser will <code>install</code> but <strong>NOT</strong> <code>activate</code>
the new version because the older one is still active and running. Refreshing a second time will unload the old one and <code>activate</code> the newest version that is installed.</p> <p>Once activated the service worker can handle events for <code>fetch</code> and messaging between the worker and the webpage.</p> <p>The <code>install</code> event is the best time to create any new version of the file cache array that you will need for your new service worker.</p> <p>The <code>activate</code> event is when you would delete old versions of the file cache.</p> <p>If you want to update your IndexedDB then you can open the new version of the database from inside your <code>activate</code> event listener function and use the IndexedDB <code>upgradeneeded</code> event to make any
structural changes you want to the local database.</p> <p>Inside your Service Worker file you can add listeners for the <code>install</code> and <code>activate</code> events. The keyword <code>self</code> is used in the service worker script to refer to itself.</p> <div class="custom-block tip"><p class="custom-block-title">SELF</p> <p>In your normal non-worker browser scripts the global object that holds everything is <code>window</code>. In a Service Worker, it is a different execution context, and we use the keyword <code>self</code> as the global
object.</p></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//code to run when the install event happens</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//code to run when the service worker becomes active</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Since, the manner in which cached files, database access, and fetch calls are handled, can be very sensitive to the specific version of the client side script in the browser we have to be able to
manage the installing and activating of these shared service workers.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>installing -&gt; installed -&gt; waiting -&gt; activating -&gt; activated -&gt; idle -&gt; stopped -&gt; terminated
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The <code>idle</code> phase happens when the webpage is still active but the service worker has nothing to do.</p> <p>The <code>stopped</code> phase happens when the tabs for the current domain are all closed. The service worker is still registered and installed but it is dormant. Once another page for that domain is loaded,
the Service Worker can become activated again.</p> <p>The <code>terminated</code> phase happens when a service worker is unregistered | uninstalled. This must happen before a new service worker for the domain gets activated.</p> <p><img src="/w2023/assets/img/lifecycle.1d49eede.png" alt="lifecycle image"></p> <p><a href="https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle" target="_blank" rel="noopener noreferrer">More reading on the lifeCycle<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="dev-tools-for-service-workers"><a href="#dev-tools-for-service-workers" class="header-anchor">#</a> Dev Tools for Service Workers</h3> <p>In Chrome, we can use the <code>Application</code> tab in the Dev Tools to find everything we need to work with Service Workers. Service Worker Registration, IndexedDB, localStorage, Cookies, Caches, Manifest,
and Background Services are all found in this tab.</p> <p>If you select the <code>Service Workers</code> item on the left side of the <code>Application</code> tab, then you can control the behaviour of the current Service Worker for the current origin. The tab will display the
current status of any Service Workers that have been installed for the origin. It will show you the <strong>active</strong> Service Worker plus all the <strong>installed</strong> ones. You can skipWaiting on the <strong>installed</strong>
ones to have them replace the <strong>active</strong> one on the next refresh.</p> <p>There are three checkboxes at the top of the tab:</p> <ul><li>Offline</li> <li>Update on Reload</li> <li>Bypass for Network</li></ul> <p>The Offline checkbox has the same effect as the Throttling dropdown menu on the Network tab. It lets you ask the browser to pretend to be offline (no internet connection).</p> <p>The Update on Reload checkbox will tell the browser to refresh the install of the Service Worker every time you refresh the web page. This can be useful if you are making frequent changes to the
Service Worker.</p> <p>The Bypass for Network checkbox is to tell the Service Worker to skip handling any fetch requests from the webpage and let them all go directly to the Server and back to the web page.</p> <p>The other important feature on this tab is the link on the top-right which lets you unregister and remove a Service Worker from an origin.</p> <p>Service Workers try to remain installed and control any pages for the same domain. This means that if you are doing development work over <code>127.0.0.1:5500</code> from VSCode for different sites, you might
get unexpected results if an old Service Worker is still install and registered for that domain, when you test your new site.</p> <p>Another dev tool resource that you can use (in Chrome) with Service workers is the url <a href="chrome://serviceworker-internals" target="_blank">chrome://serviceworker-internals</a> which will list
ALL the currently installed Service Workers in your browser and let you manage them.</p> <h3 id="service-worker-playlist"><a href="#service-worker-playlist" class="header-anchor">#</a> Service Worker Playlist</h3> <p>Here is a whole playlist tutorial on how to build and use Service Workers.</p> <p><a href="https://www.youtube.com/watch?v=NJRu3pmmN-4&amp;list=PLyuRouwmQCjl4iJgjH3i61tkqauM-NTGj" target="_blank" rel="noopener noreferrer">Service Worker Playlist<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The videos in the playlist are:</p> <ol><li>Registration, Life-Cycle, Events, and Dev Tools</li> <li>The Cache API</li> <li>waitUntil, skipWaiting, claim</li> <li>How to integrate Caches</li> <li>The Storage API</li> <li>Controlling Fetch Calls</li> <li>When Fetch Goes Wrong</li> <li>Messaging Between Tabs and Service Workers</li> <li>Integrating a Database</li> <li>Building a Custom Response Object</li> <li>File Handling for Web Apps</li> <li>Clients API and Window Messaging</li></ol> <h2 id="todo-this-week"><a href="#todo-this-week" class="header-anchor">#</a> ToDo This Week</h2> <div class="custom-block danger"><p class="custom-block-title">To Do this week</p> <ul><li>read all the content for modules 4.1 and 4.2</li> <li>Complete and submit the <a href="/w2023/assignments/exer/">Cache API assignment</a>.</li> <li>Read through the details of the <a href="/w2023/assignments/exer/">Service Worker assignment</a>.</li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/30/2023, 8:53:33 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/w2023/modules/web-components/week3/3.2/" class="prev">
        3.2: Cache, Files &amp; Responses
      </a></span> <span class="next"><a href="/w2023/modules/web-components/week4/4.2/">
        4.2: Service Workers
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/w2023/assets/js/app.49733bfc.js" defer></script><script src="/w2023/assets/js/2.e00fc094.js" defer></script><script src="/w2023/assets/js/15.bacbf527.js" defer></script><script src="/w2023/assets/js/9.b21c66c5.js" defer></script><script src="/w2023/assets/js/11.92cefe25.js" defer></script>
  </body>
</html>
